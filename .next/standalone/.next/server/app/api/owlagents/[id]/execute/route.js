"use strict";(()=>{var e={};e.id=244,e.ids=[244],e.modules={10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},29021:e=>{e.exports=require("fs")},33873:e=>{e.exports=require("path")},76041:(e,t,r)=>{r.r(t),r.d(t,{patchFetch:()=>E,routeModule:()=>g,serverHooks:()=>v,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>x});var s={};r.r(s),r.d(s,{POST:()=>y});var a=r(42706),o=r(28203),i=r(45994),n=r(39187),u=r(29021),d=r(33873),h=r.n(d),l=r(12714),p=r(50658);let c=h().join(process.cwd(),"data","owlagents"),w=new l.$0;async function f(e,t,r=!0){let s=Date.now(),a=[];try{if(a.push(`Starting execution of agent: ${e.name}`),a.push(`Input: ${JSON.stringify(t)}`),a.push(`Execution mode: ${r?"Native Engine":"Flowise"}`),!r&&e.flowiseChatflowId)try{a.push(`Executing via Flowise chatflow: ${e.flowiseChatflowId}`);let r=await w.predict(e.flowiseChatflowId,"string"==typeof t?t:JSON.stringify(t)),o=Date.now()-s;return a.push(`Execution completed in ${o}ms`),{success:!0,output:r.text||r.json||r,executionTime:o,logs:a,flowiseResponse:r}}catch(e){a.push(`Flowise execution failed: ${e}`),a.push("Falling back to native execution...")}a.push(`Executing with Native Engine: ${e.flow.nodes.length} nodes`);let o=await (0,p.i)(e.flow.nodes,e.flow.edges,t);return o.logs.forEach(e=>a.push(e)),{...o,logs:a}}catch(t){let e=Date.now()-s;return a.push(`Execution failed: ${t}`),{success:!1,output:null,executionTime:e,logs:a,error:t instanceof Error?t.message:"Unknown error"}}}async function y(e,{params:t}){try{let r;let{id:s}=await t,{input:a,useNative:o=!0,useFlowise:i=!1}=await e.json(),d=h().join(c,`${s}.json`);try{let e=await u.promises.readFile(d,"utf-8");r=JSON.parse(e)}catch{return n.NextResponse.json({error:`Agent with id ${s} not found`},{status:404})}let l=await f(r,a,!i&&o);return n.NextResponse.json(l)}catch(e){return console.error("Error executing agent:",e),n.NextResponse.json({error:"Internal server error"},{status:500})}}let g=new a.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/owlagents/[id]/execute/route",pathname:"/api/owlagents/[id]/execute",filename:"route",bundlePath:"app/api/owlagents/[id]/execute/route"},resolvedPagePath:"C:\\Users\\yrk20\\OwliaFabrica2\\app\\api\\owlagents\\[id]\\execute\\route.ts",nextConfigOutput:"standalone",userland:s}),{workAsyncStorage:m,workUnitAsyncStorage:x,serverHooks:v}=g;function E(){return(0,i.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:x})}},12714:(e,t,r)=>{r.d(t,{$0:()=>s,uD:()=>a});class s{constructor(e){this.baseUrl=e?.apiUrl||process.env.FLOWISE_API_URL||"http://localhost:3000",this.apiKey=e?.apiKey||process.env.FLOWISE_API_KEY||""}getHeaders(e="application/json"){let t={"Content-Type":e};return this.apiKey&&(t.Authorization=`Bearer ${this.apiKey}`),t}async request(e,t={}){let r=`${this.baseUrl}${e}`;try{let e=await fetch(r,{...t,headers:{...this.getHeaders(),...t.headers}});if(!e.ok){let t=await e.json().catch(()=>({}));throw new a(e.status,t.message||`API request failed: ${e.statusText}`,t)}return await e.json()}catch(e){if(e instanceof a)throw e;throw new a(0,`Network error: ${e instanceof Error?e.message:"Unknown error"}`,{originalError:e})}}async predict(e,t,r={}){let s={question:t};return r.sessionId&&(s.sessionId=r.sessionId),r.overrideConfig&&(s.overrideConfig=r.overrideConfig),r.history&&(s.history=r.history),r.uploads&&(s.uploads=r.uploads),r.humanInput&&(s.humanInput=r.humanInput),this.request(`/api/v1/prediction/${e}`,{method:"POST",body:JSON.stringify(s)})}async predictStream(e,t,r={},s){let o={question:t,streaming:!0};r.sessionId&&(o.sessionId=r.sessionId),r.overrideConfig&&(o.overrideConfig=r.overrideConfig),r.history&&(o.history=r.history);let i=`${this.baseUrl}/api/v1/prediction/${e}`,n=await fetch(i,{method:"POST",headers:this.getHeaders(),body:JSON.stringify(o)});if(!n.ok)throw new a(n.status,`Stream request failed: ${n.statusText}`);let u=n.body?.getReader();if(!u)throw new a(0,"Response body is not readable");let d=new TextDecoder,h="";try{for(;;){let{done:e,value:t}=await u.read();if(e)break;let r=d.decode(t,{stream:!0});h+=r,s&&s(r)}}finally{u.releaseLock()}return{text:h}}async submitHumanInput(e,t){return this.request(`/api/v1/prediction/${e}`,{method:"POST",body:JSON.stringify({humanInput:t})})}async getChatflows(){return this.request("/api/v1/chatflows",{method:"GET"})}async getChatflow(e){return this.request(`/api/v1/chatflows/${e}`,{method:"GET"})}async createChatflow(e){return this.request("/api/v1/chatflows",{method:"POST",body:JSON.stringify(e)})}async updateChatflow(e,t){return this.request(`/api/v1/chatflows/${e}`,{method:"PUT",body:JSON.stringify(t)})}async deleteChatflow(e){await this.request(`/api/v1/chatflows/${e}`,{method:"DELETE"})}async uploadFiles(e,t){let r=new FormData;e.forEach(e=>{r.append("files",e)}),t&&r.append("chatflowId",t);let s=`${this.baseUrl}/api/v1/get-upload-file`,o=await fetch(s,{method:"POST",headers:{...this.apiKey&&{Authorization:`Bearer ${this.apiKey}`}},body:r});if(!o.ok)throw new a(o.status,`File upload failed: ${o.statusText}`);let i=await o.json();return i.data||i}async healthCheck(){try{if((await fetch(`${this.baseUrl}/api/v1/ping`,{method:"GET"})).ok)return!0;return(await fetch(this.baseUrl,{method:"GET"})).ok}catch{return!1}}getConfig(){return{apiUrl:this.baseUrl,apiKey:this.apiKey,chatflowId:process.env.FLOWISE_DEFAULT_CHATFLOW_ID||""}}}class a extends Error{constructor(e,t,r){super(t),this.statusCode=e,this.details=r,this.name="FlowiseAPIError"}isNotFound(){return 404===this.statusCode}isUnauthorized(){return 401===this.statusCode}isValidationError(){return 422===this.statusCode}}new s}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[989,452,830],()=>r(76041));module.exports=s})();