(()=>{var e={};e.id=854,e.ids=[854],e.modules={10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},29021:e=>{"use strict";e.exports=require("fs")},33873:e=>{"use strict";e.exports=require("path")},26465:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>E,routeModule:()=>j,serverHooks:()=>A,workAsyncStorage:()=>v,workUnitAsyncStorage:()=>x});var s={};r.r(s),r.d(s,{DELETE:()=>O,GET:()=>m,POST:()=>I,PUT:()=>C});var a=r(42706),o=r(28203),n=r(45994),i=r(39187),l=r(29021),d=r(33873),u=r.n(d),c=r(75285);let w=new(r(12714)).$0,h=u().join(process.cwd(),"data","owlagents");async function p(){try{await l.promises.access(h)}catch{await l.promises.mkdir(h,{recursive:!0})}}async function f(){await p();try{let e=await l.promises.readdir(h),t=[];for(let r of e)if(r.endsWith(".json")){let e=u().join(h,r),s=await l.promises.readFile(e,"utf-8");try{let e=JSON.parse(s);t.push(e)}catch(e){console.error(`Error parsing Owl Agent file ${r}:`,e)}}return t.sort((e,t)=>{let r=new Date(e.updatedAt||e.createdAt||0).getTime();return new Date(t.updatedAt||t.createdAt||0).getTime()-r})}catch(e){return console.error("Error reading Owl Agents:",e),[]}}async function y(e){await p();let t=u().join(h,`${e.id}.json`);await l.promises.writeFile(t,JSON.stringify(e,null,2))}async function g(e){try{let t=u().join(h,`${e}.json`);return await l.promises.unlink(t),!0}catch(t){return console.error(`Error deleting Owl Agent ${e}:`,t),!1}}async function m(e){try{let{searchParams:t}=new URL(e.url),r=t.get("id");if(r){let e=u().join(h,`${r}.json`);try{let t=await l.promises.readFile(e,"utf-8"),r=JSON.parse(t);return i.NextResponse.json(r)}catch(e){return i.NextResponse.json({error:`Owl Agent with id ${r} not found`},{status:404})}}else{let e=await f();return i.NextResponse.json(e)}}catch(e){return console.error("Error in GET /api/owlagents:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}async function I(e){try{let t=await e.json();if(!t.name||!t.description||!t.flow)return i.NextResponse.json({error:"Missing required fields: name, description, or flow"},{status:400});let r={id:(0,c.A)(),name:t.name,description:t.description,iconStyle:t.iconStyle||"default",inputSchema:t.inputSchema,outputSchema:t.outputSchema,version:t.version||"1.0.0",flow:t.flow,createdAt:new Date,updatedAt:new Date,author:t.author,tags:t.tags};if(t.syncToFlowise&&t.flowiseChatflowId)r.flowiseChatflowId=t.flowiseChatflowId;else if(t.syncToFlowise)try{if(await w.healthCheck()){let e=t.flowiseFlowData||'{"nodes":[],"edges":[]}',s=await w.createChatflow({name:`OwlAgent: ${t.name}`,flowData:e,deployed:!0,category:"OwliaFabrica"});r.flowiseChatflowId=s.id}}catch(e){console.warn("Failed to sync to Flowise:",e)}return await y(r),i.NextResponse.json(r,{status:201})}catch(e){return console.error("Error in POST /api/owlagents:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}async function C(e){try{let t;let r=await e.json();if(!r.id)return i.NextResponse.json({error:"Missing Owl Agent ID"},{status:400});let s=u().join(h,`${r.id}.json`);try{let e=await l.promises.readFile(s,"utf-8");t=JSON.parse(e)}catch{return i.NextResponse.json({error:`Owl Agent with id ${r.id} not found`},{status:404})}let a={...t,...r,id:t.id,createdAt:t.createdAt,updatedAt:new Date};if(r.syncToFlowise)try{if(await w.healthCheck()){let e=r.flowiseFlowData||'{"nodes":[],"edges":[]}';if(t.flowiseChatflowId)try{await w.updateChatflow(t.flowiseChatflowId,{name:`OwlAgent: ${r.name||t.name}`,flowData:e,deployed:!0}),a.flowiseChatflowId=t.flowiseChatflowId}catch(o){console.warn("Failed to update Flowise chatflow, creating new one:",o);let s=await w.createChatflow({name:`OwlAgent: ${r.name||t.name}`,flowData:e,deployed:!0,category:"OwliaFabrica"});a.flowiseChatflowId=s.id}else{let s=await w.createChatflow({name:`OwlAgent: ${r.name||t.name}`,flowData:e,deployed:!0,category:"OwliaFabrica"});a.flowiseChatflowId=s.id}}}catch(e){console.warn("Failed to sync to Flowise:",e)}return await y(a),i.NextResponse.json(a)}catch(e){return console.error("Error in PUT /api/owlagents:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}async function O(e){try{let{searchParams:t}=new URL(e.url),r=t.get("id");if(!r)return i.NextResponse.json({error:"Missing Owl Agent ID"},{status:400});if(await g(r))return i.NextResponse.json({message:"Owl Agent deleted successfully"});return i.NextResponse.json({error:`Owl Agent with id ${r} not found`},{status:404})}catch(e){return console.error("Error in DELETE /api/owlagents:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}let j=new a.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/owlagents/route",pathname:"/api/owlagents",filename:"route",bundlePath:"app/api/owlagents/route"},resolvedPagePath:"C:\\Users\\yrk20\\OwliaFabrica2\\app\\api\\owlagents\\route.ts",nextConfigOutput:"standalone",userland:s}),{workAsyncStorage:v,workUnitAsyncStorage:x,serverHooks:A}=j;function E(){return(0,n.patchFetch)({workAsyncStorage:v,workUnitAsyncStorage:x})}},96487:()=>{},78335:()=>{},12714:(e,t,r)=>{"use strict";r.d(t,{$0:()=>s,uD:()=>a});class s{constructor(e){this.baseUrl=e?.apiUrl||process.env.FLOWISE_API_URL||"http://localhost:3000",this.apiKey=e?.apiKey||process.env.FLOWISE_API_KEY||""}getHeaders(e="application/json"){let t={"Content-Type":e};return this.apiKey&&(t.Authorization=`Bearer ${this.apiKey}`),t}async request(e,t={}){let r=`${this.baseUrl}${e}`;try{let e=await fetch(r,{...t,headers:{...this.getHeaders(),...t.headers}});if(!e.ok){let t=await e.json().catch(()=>({}));throw new a(e.status,t.message||`API request failed: ${e.statusText}`,t)}return await e.json()}catch(e){if(e instanceof a)throw e;throw new a(0,`Network error: ${e instanceof Error?e.message:"Unknown error"}`,{originalError:e})}}async predict(e,t,r={}){let s={question:t};return r.sessionId&&(s.sessionId=r.sessionId),r.overrideConfig&&(s.overrideConfig=r.overrideConfig),r.history&&(s.history=r.history),r.uploads&&(s.uploads=r.uploads),r.humanInput&&(s.humanInput=r.humanInput),this.request(`/api/v1/prediction/${e}`,{method:"POST",body:JSON.stringify(s)})}async predictStream(e,t,r={},s){let o={question:t,streaming:!0};r.sessionId&&(o.sessionId=r.sessionId),r.overrideConfig&&(o.overrideConfig=r.overrideConfig),r.history&&(o.history=r.history);let n=`${this.baseUrl}/api/v1/prediction/${e}`,i=await fetch(n,{method:"POST",headers:this.getHeaders(),body:JSON.stringify(o)});if(!i.ok)throw new a(i.status,`Stream request failed: ${i.statusText}`);let l=i.body?.getReader();if(!l)throw new a(0,"Response body is not readable");let d=new TextDecoder,u="";try{for(;;){let{done:e,value:t}=await l.read();if(e)break;let r=d.decode(t,{stream:!0});u+=r,s&&s(r)}}finally{l.releaseLock()}return{text:u}}async submitHumanInput(e,t){return this.request(`/api/v1/prediction/${e}`,{method:"POST",body:JSON.stringify({humanInput:t})})}async getChatflows(){return this.request("/api/v1/chatflows",{method:"GET"})}async getChatflow(e){return this.request(`/api/v1/chatflows/${e}`,{method:"GET"})}async createChatflow(e){return this.request("/api/v1/chatflows",{method:"POST",body:JSON.stringify(e)})}async updateChatflow(e,t){return this.request(`/api/v1/chatflows/${e}`,{method:"PUT",body:JSON.stringify(t)})}async deleteChatflow(e){await this.request(`/api/v1/chatflows/${e}`,{method:"DELETE"})}async uploadFiles(e,t){let r=new FormData;e.forEach(e=>{r.append("files",e)}),t&&r.append("chatflowId",t);let s=`${this.baseUrl}/api/v1/get-upload-file`,o=await fetch(s,{method:"POST",headers:{...this.apiKey&&{Authorization:`Bearer ${this.apiKey}`}},body:r});if(!o.ok)throw new a(o.status,`File upload failed: ${o.statusText}`);let n=await o.json();return n.data||n}async healthCheck(){try{if((await fetch(`${this.baseUrl}/api/v1/ping`,{method:"GET"})).ok)return!0;return(await fetch(this.baseUrl,{method:"GET"})).ok}catch{return!1}}getConfig(){return{apiUrl:this.baseUrl,apiKey:this.apiKey,chatflowId:process.env.FLOWISE_DEFAULT_CHATFLOW_ID||""}}}class a extends Error{constructor(e,t,r){super(t),this.statusCode=e,this.details=r,this.name="FlowiseAPIError"}isNotFound(){return 404===this.statusCode}isUnauthorized(){return 401===this.statusCode}isValidationError(){return 422===this.statusCode}}new s},75285:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});let s=require("node:crypto"),a={randomUUID:s.randomUUID},o=new Uint8Array(256),n=o.length,i=[];for(let e=0;e<256;++e)i.push((e+256).toString(16).slice(1));let l=function(e,t,r){return!a.randomUUID||t||e?function(e,t,r){let a=(e=e||{}).random??e.rng?.()??(n>o.length-16&&((0,s.randomFillSync)(o),n=0),o.slice(n,n+=16));if(a.length<16)throw Error("Random bytes length must be >= 16");if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t){if((r=r||0)<0||r+16>t.length)throw RangeError(`UUID byte range ${r}:${r+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[r+e]=a[e];return t}return function(e,t=0){return(i[e[t+0]]+i[e[t+1]]+i[e[t+2]]+i[e[t+3]]+"-"+i[e[t+4]]+i[e[t+5]]+"-"+i[e[t+6]]+i[e[t+7]]+"-"+i[e[t+8]]+i[e[t+9]]+"-"+i[e[t+10]]+i[e[t+11]]+i[e[t+12]]+i[e[t+13]]+i[e[t+14]]+i[e[t+15]]).toLowerCase()}(a)}(e,t,r):a.randomUUID()}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[989,452],()=>r(26465));module.exports=s})();