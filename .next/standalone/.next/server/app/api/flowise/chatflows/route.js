(()=>{var e={};e.id=919,e.ids=[919],e.modules={10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},50152:(e,s,t)=>{"use strict";t.r(s),t.d(s,{patchFetch:()=>m,routeModule:()=>f,serverHooks:()=>g,workAsyncStorage:()=>w,workUnitAsyncStorage:()=>y});var r={};t.r(r),t.d(r,{DELETE:()=>p,GET:()=>l,POST:()=>d,PUT:()=>h});var a=t(42706),o=t(28203),i=t(45994),n=t(39187),u=t(12714);let c=new u.$0;async function l(e){try{let{searchParams:s}=new URL(e.url),t=s.get("id");if(!await c.healthCheck())return n.NextResponse.json({success:!1,error:"Flowise server is not available",details:"Please ensure Flowise is running and accessible"},{status:503});if(t){let e=await c.getChatflow(t);return n.NextResponse.json({success:!0,chatflow:e})}let r=await c.getChatflows();return n.NextResponse.json(r)}catch(e){if(console.error("Error fetching chatflows:",e),e instanceof u.uD)return n.NextResponse.json({success:!1,error:"Flowise API error",details:e.message,statusCode:e.statusCode},{status:e.statusCode||500});return n.NextResponse.json({success:!1,error:"Failed to fetch chatflows",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function d(e){try{let{name:s,flowData:t,deployed:r,isPublic:a,category:o,type:i}=await e.json();if(!s)return n.NextResponse.json({success:!1,error:"Missing required field: name"},{status:400});if(!await c.healthCheck())return n.NextResponse.json({success:!1,error:"Flowise server is not available"},{status:503});let u=await c.createChatflow({name:s,flowData:t||'{"nodes":[],"edges":[]}',deployed:r??!1,isPublic:a??!1,category:o||"OwliaFabrica",type:i||"CHATFLOW"});return n.NextResponse.json({success:!0,chatflow:u,message:"Chatflow created successfully"})}catch(e){if(console.error("Error creating chatflow:",e),e instanceof u.uD)return n.NextResponse.json({success:!1,error:"Flowise API error",details:e.message},{status:e.statusCode||500});return n.NextResponse.json({success:!1,error:"Failed to create chatflow",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function h(e){try{let{id:s,name:t,flowData:r,deployed:a,isPublic:o,category:i}=await e.json();if(!s)return n.NextResponse.json({success:!1,error:"Missing required field: id"},{status:400});if(!await c.healthCheck())return n.NextResponse.json({success:!1,error:"Flowise server is not available"},{status:503});let u={};void 0!==t&&(u.name=t),void 0!==r&&(u.flowData=r),void 0!==a&&(u.deployed=a),void 0!==o&&(u.isPublic=o),void 0!==i&&(u.category=i);let l=await c.updateChatflow(s,u);return n.NextResponse.json({success:!0,chatflow:l,message:"Chatflow updated successfully"})}catch(e){if(console.error("Error updating chatflow:",e),e instanceof u.uD)return n.NextResponse.json({success:!1,error:"Flowise API error",details:e.message},{status:e.statusCode||500});return n.NextResponse.json({success:!1,error:"Failed to update chatflow",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function p(e){try{let{searchParams:s}=new URL(e.url),t=s.get("id");if(!t)return n.NextResponse.json({success:!1,error:"Missing required parameter: id"},{status:400});if(!await c.healthCheck())return n.NextResponse.json({success:!1,error:"Flowise server is not available"},{status:503});return await c.deleteChatflow(t),n.NextResponse.json({success:!0,message:`Chatflow ${t} deleted successfully`})}catch(e){if(console.error("Error deleting chatflow:",e),e instanceof u.uD)return n.NextResponse.json({success:!1,error:"Flowise API error",details:e.message},{status:e.statusCode||500});return n.NextResponse.json({success:!1,error:"Failed to delete chatflow",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}let f=new a.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/flowise/chatflows/route",pathname:"/api/flowise/chatflows",filename:"route",bundlePath:"app/api/flowise/chatflows/route"},resolvedPagePath:"C:\\Users\\yrk20\\OwliaFabrica2\\app\\api\\flowise\\chatflows\\route.ts",nextConfigOutput:"standalone",userland:r}),{workAsyncStorage:w,workUnitAsyncStorage:y,serverHooks:g}=f;function m(){return(0,i.patchFetch)({workAsyncStorage:w,workUnitAsyncStorage:y})}},96487:()=>{},78335:()=>{},12714:(e,s,t)=>{"use strict";t.d(s,{$0:()=>r,uD:()=>a});class r{constructor(e){this.baseUrl=e?.apiUrl||process.env.FLOWISE_API_URL||"http://localhost:3000",this.apiKey=e?.apiKey||process.env.FLOWISE_API_KEY||""}getHeaders(e="application/json"){let s={"Content-Type":e};return this.apiKey&&(s.Authorization=`Bearer ${this.apiKey}`),s}async request(e,s={}){let t=`${this.baseUrl}${e}`;try{let e=await fetch(t,{...s,headers:{...this.getHeaders(),...s.headers}});if(!e.ok){let s=await e.json().catch(()=>({}));throw new a(e.status,s.message||`API request failed: ${e.statusText}`,s)}return await e.json()}catch(e){if(e instanceof a)throw e;throw new a(0,`Network error: ${e instanceof Error?e.message:"Unknown error"}`,{originalError:e})}}async predict(e,s,t={}){let r={question:s};return t.sessionId&&(r.sessionId=t.sessionId),t.overrideConfig&&(r.overrideConfig=t.overrideConfig),t.history&&(r.history=t.history),t.uploads&&(r.uploads=t.uploads),t.humanInput&&(r.humanInput=t.humanInput),this.request(`/api/v1/prediction/${e}`,{method:"POST",body:JSON.stringify(r)})}async predictStream(e,s,t={},r){let o={question:s,streaming:!0};t.sessionId&&(o.sessionId=t.sessionId),t.overrideConfig&&(o.overrideConfig=t.overrideConfig),t.history&&(o.history=t.history);let i=`${this.baseUrl}/api/v1/prediction/${e}`,n=await fetch(i,{method:"POST",headers:this.getHeaders(),body:JSON.stringify(o)});if(!n.ok)throw new a(n.status,`Stream request failed: ${n.statusText}`);let u=n.body?.getReader();if(!u)throw new a(0,"Response body is not readable");let c=new TextDecoder,l="";try{for(;;){let{done:e,value:s}=await u.read();if(e)break;let t=c.decode(s,{stream:!0});l+=t,r&&r(t)}}finally{u.releaseLock()}return{text:l}}async submitHumanInput(e,s){return this.request(`/api/v1/prediction/${e}`,{method:"POST",body:JSON.stringify({humanInput:s})})}async getChatflows(){return this.request("/api/v1/chatflows",{method:"GET"})}async getChatflow(e){return this.request(`/api/v1/chatflows/${e}`,{method:"GET"})}async createChatflow(e){return this.request("/api/v1/chatflows",{method:"POST",body:JSON.stringify(e)})}async updateChatflow(e,s){return this.request(`/api/v1/chatflows/${e}`,{method:"PUT",body:JSON.stringify(s)})}async deleteChatflow(e){await this.request(`/api/v1/chatflows/${e}`,{method:"DELETE"})}async uploadFiles(e,s){let t=new FormData;e.forEach(e=>{t.append("files",e)}),s&&t.append("chatflowId",s);let r=`${this.baseUrl}/api/v1/get-upload-file`,o=await fetch(r,{method:"POST",headers:{...this.apiKey&&{Authorization:`Bearer ${this.apiKey}`}},body:t});if(!o.ok)throw new a(o.status,`File upload failed: ${o.statusText}`);let i=await o.json();return i.data||i}async healthCheck(){try{if((await fetch(`${this.baseUrl}/api/v1/ping`,{method:"GET"})).ok)return!0;return(await fetch(this.baseUrl,{method:"GET"})).ok}catch{return!1}}getConfig(){return{apiUrl:this.baseUrl,apiKey:this.apiKey,chatflowId:process.env.FLOWISE_DEFAULT_CHATFLOW_ID||""}}}class a extends Error{constructor(e,s,t){super(s),this.statusCode=e,this.details=t,this.name="FlowiseAPIError"}isNotFound(){return 404===this.statusCode}isUnauthorized(){return 401===this.statusCode}isValidationError(){return 422===this.statusCode}}new r}};var s=require("../../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[989,452],()=>t(50152));module.exports=r})();