(()=>{var e={};e.id=843,e.ids=[843],e.modules={10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},9816:(e,t,a)=>{"use strict";a.r(t),a.d(t,{GlobalError:()=>n.a,__next_app__:()=>p,pages:()=>c,routeModule:()=>u,tree:()=>d});var r=a(70260),s=a(28203),o=a(25155),n=a.n(o),l=a(67292),i={};for(let e in l)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(i[e]=()=>l[e]);a.d(t,i);let d=["",{children:["agent-canvas",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,71585)),"C:\\Users\\yrk20\\OwliaFabrica2\\app\\agent-canvas\\[id]\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,19611)),"C:\\Users\\yrk20\\OwliaFabrica2\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,19937,23)),"next/dist/client/components/not-found-error"]}],c=["C:\\Users\\yrk20\\OwliaFabrica2\\app\\agent-canvas\\[id]\\page.tsx"],p={require:a,loadChunk:()=>Promise.resolve()},u=new r.AppPageRouteModule({definition:{kind:s.RouteKind.APP_PAGE,page:"/agent-canvas/[id]/page",pathname:"/agent-canvas/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},76160:(e,t,a)=>{Promise.resolve().then(a.bind(a,71585))},63008:(e,t,a)=>{Promise.resolve().then(a.bind(a,42973))},42973:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>A});var r=a(45512),s=a(58009),o=a(20526),n=a(67625),l=a(82040),i=a(22387);a(17163);var d=a(20908),c=a(84438),p=a(77800),u=a(71229),x=a(61126),g=a(79334),h=a(32493),f=a(54543),m=a(83505),v=a(3175),b=a(85828),y=a(61986),C=a(17289);let j={custom:f.A},w={buttonedge:m.A};function k(){let e=(0,g.useRouter)();(0,g.useParams)().id;let t=(0,s.useRef)(null),[a,f]=(0,s.useState)(null),[m,k,A]=(0,o.ck)([]),[S,I,D]=(0,o.fM)([]),[F,B]=(0,s.useState)(null),[T,P]=(0,s.useState)(!1),[_,O]=(0,s.useState)(!1),[E,N]=(0,s.useState)(!1),[R,q]=(0,s.useState)([]),[H,z]=(0,s.useState)(null),[G,U]=(0,s.useState)(!0),[W,$]=(0,s.useState)(!1),[M,L]=(0,s.useState)(""),[J,K]=(0,s.useState)(""),[V,X]=(0,s.useState)(""),[Y,Q]=(0,s.useState)(!0),[Z,ee]=(0,s.useState)({open:!1,message:"",severity:"info"}),et=(0,s.useRef)();et.current=e=>{let t=m.find(t=>t.id===e);t&&(B(t),P(!0))};let ea=(0,s.useRef)();ea.current=e=>{k(t=>t.filter(t=>t.id!==e)),I(t=>t.filter(t=>t.source!==e&&t.target!==e)),F?.id===e&&(B(null),P(!1))};let er=(0,s.useCallback)(e=>{et.current?.(e)},[]),es=(0,s.useCallback)(e=>{ea.current?.(e)},[]),eo=(0,s.useCallback)(e=>{I(t=>(0,o.rN)({...e,type:"smoothstep",animated:!0},t))},[I]),en=(0,s.useCallback)(e=>{e.preventDefault();let r=e.dataTransfer.getData("application/reactflow");if(!r||!a||!t.current)return;let s=JSON.parse(r),o=a.screenToFlowPosition({x:e.clientX,y:e.clientY}),n={id:`${s.type}-${Date.now()}`,type:"custom",position:o,data:{label:s.label,type:s.type,category:s.category,config:{},agentId:s.agentId,agentName:s.agentId?s.label:void 0,onConfigure:er,onDelete:es}};k(e=>[...e,n])},[a,k,er,es]),el=(0,s.useCallback)(e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"},[]),ei=(0,s.useCallback)((e,t)=>{B(t),P(!0)},[]),ed=(0,s.useCallback)((e,t,a)=>{k(r=>r.map(r=>r.id===e?{...r,data:{...r.data,config:t,humanReview:a}}:r)),B(r=>r?.id===e?{...r,data:{...r.data,config:t,humanReview:a}}:r)},[k]),ec=(0,s.useCallback)(async()=>{if(H){$(!0);try{let e;Y&&(e=(0,C.f2)(m,S));let t=await fetch("/api/owlagents",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({...H,name:M.trim(),description:J.trim(),tags:V.split(",").map(e=>e.trim()).filter(e=>e),flow:{nodes:m.map(e=>({id:e.id,type:e.data.type,position:e.position,data:{label:e.data.label,type:e.data.type,category:e.data.category,config:e.data.config,humanReview:e.data.humanReview,agentId:e.data.agentId,agentName:e.data.agentName}})),edges:S.map(e=>({id:e.id,source:e.source,target:e.target,sourceHandle:e.sourceHandle,targetHandle:e.targetHandle}))},syncToFlowise:Y,flowiseFlowData:e})});if(t.ok){let e=await t.json();z(e);let a="エージェントを保存しました";e.flowiseChatflowId&&(a+=` (Flowise: ${e.flowiseChatflowId})`),ee({open:!0,message:a,severity:"success"})}else throw Error("Save failed")}catch(e){ee({open:!0,message:"保存に失敗しました",severity:"error"})}finally{$(!1)}}},[H,M,J,V,m,S,Y]);return G?(0,r.jsx)(d.Box,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",bgcolor:"#0f0f1a"},children:(0,r.jsx)(d.CircularProgress,{sx:{color:"#6366f1"}})}):H?(0,r.jsxs)(d.Box,{sx:{display:"flex",flexDirection:"column",height:"100vh",bgcolor:"#0f0f1a"},children:[(0,r.jsxs)(d.Paper,{sx:{borderRadius:0,bgcolor:"#16213e",borderBottom:"2px solid #0f3460",px:2,py:1,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,r.jsxs)(d.Box,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,r.jsx)(d.IconButton,{onClick:()=>e.push("/agent-canvas"),sx:{color:"#90CAF9"},children:(0,r.jsx)(u.A,{})}),(0,r.jsxs)(d.Typography,{variant:"h6",sx:{fontWeight:700,color:"#e94560",display:"flex",alignItems:"center",gap:1},children:[(0,r.jsx)("span",{style:{fontSize:"1.3rem"},children:"\uD83E\uDD89"}),M||"Untitled Agent"]}),(0,r.jsx)(d.Chip,{label:`v${H.version}`,size:"small",sx:{bgcolor:"#4CAF50",color:"#fff"}}),(0,r.jsx)(d.Chip,{label:`${m.length} nodes`,size:"small",variant:"outlined",sx:{color:"#90CAF9",borderColor:"#90CAF9"}})]}),(0,r.jsxs)(d.Box,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,r.jsx)(d.Tooltip,{title:"Settings",children:(0,r.jsx)(d.IconButton,{onClick:()=>N(!0),sx:{color:"#90CAF9"},children:(0,r.jsx)(x.A,{})})}),(0,r.jsx)(d.Button,{variant:"outlined",startIcon:(0,r.jsx)(p.A,{}),onClick:()=>O(!0),sx:{color:"#4CAF50",borderColor:"#4CAF50","&:hover":{borderColor:"#66BB6A",bgcolor:"rgba(76, 175, 80, 0.1)"}},children:"Test"}),(0,r.jsx)(d.Button,{variant:"contained",startIcon:W?(0,r.jsx)(d.CircularProgress,{size:20,color:"inherit"}):(0,r.jsx)(c.A,{}),onClick:ec,disabled:W,sx:{bgcolor:"#6366f1","&:hover":{bgcolor:"#5558e3"}},children:W?"Saving...":"Save"})]})]}),(0,r.jsxs)(d.Box,{sx:{display:"flex",flex:1,overflow:"hidden"},children:[(0,r.jsx)(h.A,{savedOwlAgents:R}),(0,r.jsxs)(d.Box,{ref:t,sx:{flex:1,position:"relative"},children:[(0,r.jsxs)(o.Gc,{nodes:m,edges:S,onNodesChange:A,onEdgesChange:D,onConnect:eo,onInit:f,onDrop:en,onDragOver:el,onNodeDoubleClick:ei,nodeTypes:j,edgeTypes:w,fitView:!0,snapToGrid:!0,snapGrid:[15,15],defaultEdgeOptions:{type:"smoothstep",animated:!0,style:{stroke:"#6366f1",strokeWidth:2}},style:{background:"#0f0f1a"},children:[(0,r.jsx)(n.H,{}),(0,r.jsx)(l.o,{style:{backgroundColor:"#1e1e2f"},nodeColor:e=>{let t=(0,y.KF)(e.data?.type);return t?.color||"#607D8B"}}),(0,r.jsx)(i.V,{color:"#2d2d44",gap:20,size:1})]}),0===m.length&&(0,r.jsx)(d.Box,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",textAlign:"center",pointerEvents:"none"},children:(0,r.jsx)(d.Typography,{sx:{color:"#666",fontSize:"1.2rem",mb:1},children:"Drag nodes from the palette to build your flow"})})]}),T&&F&&(0,r.jsx)(v.A,{nodeId:F.id,nodeData:F.data,onClose:()=>P(!1),onSave:ed,savedOwlAgents:R},`config-${F.id}-${JSON.stringify(F.data.config||{})}`)]}),(0,r.jsxs)(d.Dialog,{open:E,onClose:()=>N(!1),maxWidth:"sm",fullWidth:!0,children:[(0,r.jsx)(d.DialogTitle,{children:"Agent Settings"}),(0,r.jsx)(d.DialogContent,{children:(0,r.jsxs)(d.Box,{sx:{pt:1},children:[(0,r.jsx)(d.TextField,{fullWidth:!0,label:"Agent Name",value:M,onChange:e=>L(e.target.value),sx:{mb:2},required:!0}),(0,r.jsx)(d.TextField,{fullWidth:!0,label:"Description",value:J,onChange:e=>K(e.target.value),multiline:!0,rows:3,sx:{mb:2},required:!0}),(0,r.jsx)(d.TextField,{fullWidth:!0,label:"Tags (comma separated)",value:V,onChange:e=>X(e.target.value),placeholder:"e.g., AI, chatbot, support",sx:{mb:2}}),(0,r.jsx)(d.FormControlLabel,{control:(0,r.jsx)(d.Switch,{checked:Y,onChange:e=>Q(e.target.checked),color:"primary"}),label:"Flowiseに同期",sx:{display:"block"}}),(0,r.jsx)(d.Typography,{variant:"caption",color:"text.secondary",children:"有効にすると、保存時にFlowiseのChatflowとして登録/更新されます"}),H?.flowiseChatflowId&&(0,r.jsxs)(d.Typography,{variant:"caption",color:"success.main",sx:{display:"block",mt:1},children:["現在のChatflow ID: ",H.flowiseChatflowId]})]})}),(0,r.jsx)(d.DialogActions,{children:(0,r.jsx)(d.Button,{onClick:()=>N(!1),children:"Close"})})]}),(0,r.jsx)(b.A,{open:_,onClose:()=>O(!1),nodes:m,edges:S}),(0,r.jsx)(d.Snackbar,{open:Z.open,autoHideDuration:4e3,onClose:()=>ee(e=>({...e,open:!1})),anchorOrigin:{vertical:"bottom",horizontal:"right"},children:(0,r.jsx)(d.Alert,{onClose:()=>ee(e=>({...e,open:!1})),severity:Z.severity,sx:{width:"100%"},children:Z.message})})]}):(0,r.jsxs)(d.Box,{sx:{p:4,bgcolor:"#0f0f1a",minHeight:"100vh"},children:[(0,r.jsx)(d.Alert,{severity:"error",children:"エージェントが見つかりません"}),(0,r.jsx)(d.Button,{variant:"outlined",startIcon:(0,r.jsx)(u.A,{}),onClick:()=>e.push("/agent-canvas"),sx:{mt:2},children:"戻る"})]})}function A(){return(0,r.jsx)(o.Ln,{children:(0,r.jsx)(k,{})})}},71585:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>r});let r=(0,a(46760).registerClientReference)(function(){throw Error("Attempted to call the default export of \"C:\\\\Users\\\\yrk20\\\\OwliaFabrica2\\\\app\\\\agent-canvas\\\\[id]\\\\page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\yrk20\\OwliaFabrica2\\app\\agent-canvas\\[id]\\page.tsx","default")},71229:(e,t,a)=>{"use strict";a.d(t,{A:()=>o});var r=a(66214),s=a(45512);let o=(0,r.A)((0,s.jsx)("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"}),"ArrowBack")}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[989,84,80,45,52],()=>a(9816));module.exports=r})();