# OwliaFabrica 機能一覧（業務フロー × 機能マトリクス）

## 0. ユーザー目線の業務フロー図

### 0.1 全体フロー（エージェント作成〜利用）

```mermaid
flowchart TB
    subgraph 企画["🎯 企画フェーズ"]
        A1[業務課題の整理] --> A2[コンセプト設計]
        A2 --> A3{テンプレートを<br/>使う？}
    end

    subgraph 構築["🔧 構築フェーズ"]
        A3 -->|Yes| B1[テンプレート選択]
        A3 -->|No| B2[新規作成]
        B1 --> B3[キャンバスで編集]
        B2 --> B3
        B3 --> B4[RAG/ツール設定]
        B4 --> B5[人間チェック設定]
        B5 --> B6[テスト実行]
        B6 --> B7{テストOK？}
        B7 -->|No| B3
        B7 -->|Yes| B8[フクロウとして保存]
    end

    subgraph 公開["📢 公開フェーズ"]
        B8 --> C1[公開範囲設定]
        C1 --> C2[公開実行]
        C2 --> C3[ストアに登録]
    end

    subgraph 利用["💬 利用フェーズ"]
        C3 --> D1[ストアで発見]
        D1 --> D2[チャット実行]
        D2 --> D3[フィードバック]
    end

    subgraph 運用["📊 運用フェーズ"]
        D3 --> E1[利用状況確認]
        E1 --> E2{改善必要？}
        E2 -->|Yes| B3
        E2 -->|No| E3[継続運用]
        E3 --> E4{廃止検討？}
        E4 -->|Yes| E5[統合・廃止]
        E4 -->|No| E1
    end

    style 企画 fill:#e8f4fd,stroke:#1976d2
    style 構築 fill:#fff3e0,stroke:#f57c00
    style 公開 fill:#e8f5e9,stroke:#388e3c
    style 利用 fill:#fce4ec,stroke:#c2185b
    style 運用 fill:#f3e5f5,stroke:#7b1fa2
```

### 0.2 エージェント作成者の詳細フロー

```mermaid
flowchart LR
    subgraph 課題整理["1️⃣ 課題整理"]
        direction TB
        P1[繰り返し作業を<br/>リストアップ]
        P1 --> P2[優先度を決定]
        P2 --> P3[1つに絞る]
    end

    subgraph 設計["2️⃣ コンセプト設計"]
        direction TB
        D1[名前・説明を決定]
        D1 --> D2[対象ユーザー設定]
        D2 --> D3[タグ設定]
        D3 --> D4[想定Q&A整理]
    end

    subgraph 準備["3️⃣ RAG/ツール準備"]
        direction TB
        R1[必要資料の選定]
        R1 --> R2[公開範囲確認]
        R2 --> R3[RAGへ登録]
    end

    subgraph 構築["4️⃣ エージェント構築"]
        direction TB
        C1[キャンバスを開く]
        C1 --> C2[ノードを配置]
        C2 --> C3[ノード間を接続]
        C3 --> C4[各ノード設定]
        C4 --> C5[人間チェック設定]
    end

    subgraph テスト["5️⃣ テスト・修正"]
        direction TB
        T1[想定質問でテスト]
        T1 --> T2[回答を確認]
        T2 --> T3{問題あり？}
        T3 -->|Yes| T4[修正]
        T4 --> T1
        T3 -->|No| T5[完了]
    end

    subgraph 公開["6️⃣ 公開"]
        direction TB
        PB1[公開範囲選択]
        PB1 --> PB2[公開実行]
        PB2 --> PB3[完了通知]
    end

    課題整理 --> 設計 --> 準備 --> 構築 --> テスト --> 公開

    style 課題整理 fill:#bbdefb
    style 設計 fill:#c8e6c9
    style 準備 fill:#fff9c4
    style 構築 fill:#ffccbc
    style テスト fill:#e1bee7
    style 公開 fill:#b2dfdb
```

### 0.3 エージェント利用者のフロー

```mermaid
flowchart TB
    subgraph 発見["🔍 発見"]
        direction LR
        F1[ストアを開く] --> F2[検索/フィルタ]
        F2 --> F3[カード表示で<br/>能力値確認]
        F3 --> F4[詳細を確認]
    end

    subgraph 選択["✅ 選択"]
        direction LR
        S1{自分の業務に<br/>合う？}
        S1 -->|Yes| S2[このフクロウを選択]
        S1 -->|No| S3[別を探す]
        S3 --> F2
    end

    subgraph 実行["💬 実行"]
        direction LR
        E1[チャット画面を開く]
        E1 --> E2[質問を入力]
        E2 --> E3[ストリーミング応答]
        E3 --> E4[結果を確認]
    end

    subgraph 評価["⭐ 評価"]
        direction LR
        R1{役に立った？}
        R1 -->|Yes| R2[👍 評価]
        R1 -->|No| R3[👎 評価]
        R2 --> R4[コメント追加]
        R3 --> R4
    end

    subgraph カスタマイズ["🔧 カスタマイズ（任意）"]
        direction LR
        C1{調整したい？}
        C1 -->|Yes| C2[コピーして編集]
        C2 --> C3[自分用に保存]
        C1 -->|No| C4[継続利用]
    end

    発見 --> 選択 --> 実行 --> 評価 --> カスタマイズ

    style 発見 fill:#e3f2fd
    style 選択 fill:#f3e5f5
    style 実行 fill:#e8f5e9
    style 評価 fill:#fff8e1
    style カスタマイズ fill:#fce4ec
```

### 0.4 ペルソナ別フロー比較

```mermaid
flowchart TB
    subgraph 初学者["👶 初学者フロー"]
        direction LR
        A1[ストアで探す] --> A2[そのまま利用]
        A2 --> A3[必要ならカスタマイズ]
        A3 --> A4[自分用に保存]
    end

    subgraph 経験者["👨‍💻 経験者フロー"]
        direction LR
        B1[課題分析] --> B2[フロー設計・構築]
        B2 --> B3[マルチエージェント連携]
        B3 --> B4[業務システム統合]
        B4 --> B5[継続改善]
    end

    subgraph 管理者["👔 管理者フロー"]
        direction LR
        C1[利用状況監視] --> C2[品質チェック]
        C2 --> C3[ポートフォリオ整理]
        C3 --> C4[統合・廃止判断]
    end

    初学者 ~~~ 経験者 ~~~ 管理者

    style 初学者 fill:#c8e6c9
    style 経験者 fill:#bbdefb
    style 管理者 fill:#ffccbc
```

---

## 1. 機能一覧サマリー

### 1.1 MVPスコープ

| 区分 | MVP機能数 | Phase 2以降 |
|------|----------|-------------|
| エージェント作成者向け | 27機能 | 14機能 |
| エージェント利用者向け | 10機能 | 7機能 |
| 管理者・運営向け | 3機能 | 7機能 |
| RAG・ナレッジ基盤 | 2機能 | 2機能 |
| 共通・インフラ | 2機能 | 2機能 |
| **合計** | **44機能** | **32機能** |

---

## 2. 業務フロー × 機能マトリクス

### 2.1 エージェント作成フロー

| 業務フロー | 機能# | 機能名 | 概要 | MVP |
|----------|-------|--------|------|-----|
| **[1] 業務課題整理** | C-A1 | 業務課題カタログ | 繰り返し作業・FAQ・調査業務を記入するフォーム | - |
| | C-A2 | 自動優先度スコア | 頻度×負荷×影響範囲で優先度を計算 | - |
| **[2] コンセプト設計** | C-1 | 基本情報入力 | フクロウの名前・一行説明・詳細説明 | ✅ |
| | C-2 | 対象ユーザー設定 | 自分/チーム/部署/全社 | ✅ |
| | C-3 | タグ設定 | カテゴリタグの選択・追加 | ✅ |
| | C-4 | アイコン設定 | フクロウのアイコン選択 | - |
| | C-5 | フクロウテンプレート一覧 | 用途別テンプレート表示 | ✅ |
| | C-6 | テンプレートから作成 | テンプレートを選んで作成開始 | ✅ |
| | C-7 | テンプレートプレビュー | 内部ノード構成を事前確認 | - |
| **[3] RAG/ツール準備** | C-31 | RAG一覧表示 | 利用可能なRAGを表示 | ✅ |
| | C-32 | RAG選択・紐づけ | RAGノードにコレクションを紐づけ | ✅ |
| | C-33 | RAG新規作成 | Fabricaから新規RAG作成 | - |
| | C-34 | RAGファイルアップロード | 資料をアップロードしてRAG化 | - |
| **[4] エージェント構築** | C-8 | フクロウキャンバス表示 | 統一キャンバスの表示 | ✅ |
| | C-9 | フクロウ新規作成 | 新しいフクロウを配置 | ✅ |
| | C-10 | 既存フクロウ配置 | 保存済みフクロウを配置 | ✅ |
| | C-11 | フクロウ間接続 | マルチフクロウ構成 | ✅ |
| | C-12 | キャンバス保存 | キャンバス全体を保存 | ✅ |
| | C-13 | キャンバス読み込み | 保存済みキャンバスを編集 | ✅ |
| | C-14 | 内部編集モード切替 | ダブルクリックでノード編集モードへ | ✅ |
| | C-15 | ノード追加 | 抽象ノードを追加 | ✅ |
| | C-16 | ノード間接続 | ノード同士を接続 | ✅ |
| | C-17 | ノード設定パネル | 実装選択とパラメータ設定 | ✅ |
| | C-18 | フクロウ保存 | Flowise形式で保存 | ✅ |
| | C-19 | 編集モード終了 | キャンバス全体表示に戻る | ✅ |
| | C-20 | 人間チェック設定 | 人間確認ON/OFF設定 | ✅ |
| | C-21 | チェックポイント表示 | 確認箇所を視覚的にハイライト | ✅ |
| | C-22 | 確認メッセージ設定 | カスタムメッセージを設定 | - |
| | C-23 | 自動承認タイムアウト | 指定時間後の自動承認 | - |
| | C-24 | ノードテンプレート一覧 | 標準ノードを表示 | ✅ |
| | C-25 | ノードテンプレート挿入 | ワンクリック追加 | ✅ |
| | C-26 | ツールノードテンプレート一覧 | ツールノード表示 | ✅ |
| | C-27 | ツールノードテンプレート挿入 | ワンクリック追加 | ✅ |
| | C-28 | プロンプトテンプレート | システムプロンプトを選択・挿入 | ✅ |
| | C-29 | カスタムテンプレート保存 | 自作構成をテンプレ保存 | - |
| | C-30 | カスタムテンプレート共有 | チーム/全社に共有 | - |
| **[5] テスト・修正** | C-35 | テスト実行 | Flowise経由でテスト | ✅ |
| | C-36 | テスト結果表示 | 回答・RAGヒット状況を表示 | ✅ |
| | C-37 | マルチフクロウテスト | 統合テスト | ✅ |
| | C-38 | テストシナリオ登録 | 想定Q&Aを登録 | - |
| | C-39 | 一括テスト実行 | 登録シナリオをまとめて実行 | - |
| | C-40 | テストシナリオ自動生成 | フローから想定Q&Aを自動生成 | - |
| **[6] 公開** | C-41 | 公開範囲設定 | 自分/チーム/部署/全社 | ✅ |
| | C-42 | 公開実行 | 公開状態にする | ✅ |
| | C-43 | 非公開化 | 公開済みを非公開に | - |
| | C-44 | 削除 | フクロウを削除 | - |
| | C-45 | 複製 | 既存フクロウをコピー | - |

---

### 2.2 エージェント利用フロー

| 業務フロー | 機能# | 機能名 | 概要 | MVP |
|----------|-------|--------|------|-----|
| **検索・発見** | C-46 | フクロウ一覧表示 | カード/リスト形式で表示 | ✅ |
| | C-47 | 検索 | キーワードで検索 | ✅ |
| | C-48 | タグフィルタ | カテゴリタグで絞り込み | ✅ |
| | C-49 | 部門フィルタ | 作成部門・対象部門で絞り込み | - |
| | C-50 | 用途フィルタ | FAQ/資料作成/調査等で絞り込み | - |
| | C-51 | ソート | 人気順/新着順/名前順 | - |
| | C-52 | フクロウ詳細表示 | 説明・能力値・使用例・作成者情報 | ✅ |
| **マイフクロウ** | C-53 | お気に入り登録 | お気に入りに追加 | - |
| | C-54 | お気に入り一覧 | お気に入りを表示 | - |
| | C-55 | 利用履歴 | 最近使ったフクロウを表示 | - |
| **チャット実行** | C-56 | チャット画面 | フクロウと会話できるUI | ✅ |
| | C-57 | 会話履歴表示 | セッションの履歴を表示 | ✅ |
| | C-58 | ストリーミング応答 | Flowise Prediction APIのストリーミング | ✅ |
| | C-59 | ファイルアップロード | Flowiseへのファイル送信 | - |
| | C-60 | 会話リセット | 新しい会話を開始 | - |
| | C-61 | 会話履歴保存 | 過去の会話を保存・再表示 | - |
| **フィードバック** | C-62 | 評価ボタン | 👍/👎を送信 | - |
| | C-63 | コメント送信 | 評価と一緒にコメント | - |
| **外部連携** | C-64 | フクロウ情報API | Portal/Spriteが一覧を取得 | ✅ |
| | C-65 | フクロウ実行API | Flowise経由で実行 | ✅ |
| | C-66 | Flowise接続状態API | サーバーの稼働確認 | ✅ |

---

### 2.3 管理・運営フロー

| 業務フロー | 機能# | 機能名 | 概要 | MVP |
|----------|-------|--------|------|-----|
| **権限管理** | M-1 | ロール・アクセス制御 | オーナー/利用者/管理者ロール定義 | ✅ |
| **承認** | M-2 | 全社公開レビュー | 運営チーム・上長がレビュー | - |
| **監視** | M-3 | 利用状況ダッシュボード | 利用回数・ユーザー数を可視化 | - |
| | M-4 | 危険応答検知 | NGワード・リスク回答を検知 | - |
| **整理** | M-5 | 統合・廃止候補一覧 | 条件で候補をリストアップ | - |
| **版管理** | M-6 | バージョン履歴 | 変更履歴を保存 | - |
| | M-7 | ロールバック | 特定バージョンへ復元 | - |
| **監査** | M-8 | 操作ログ | 操作履歴を記録 | ✅ |
| **接続監視** | M-9 | ヘルスチェック | Flowise・RAG・APIの稼働監視 | ✅ |
| | M-10 | 多環境運用 | 開発/本番環境分離 | - |

---

### 2.4 RAG・ナレッジ管理フロー

| 業務フロー | 機能# | 機能名 | 概要 | MVP |
|----------|-------|--------|------|-----|
| **登録** | R-1 | 資料アップロード | ファイルアップロード、Portal同期 | ✅ |
| **更新** | R-2 | 再取り込み・差分更新 | 最新版への差し替え | - |
| **制御** | R-3 | RAGアクセス制御 | 部門/ロールごとの参照可否 | ✅ |

---

## 3. ノード × 実装マトリクス

### 3.1 MVP対応ノード

| 抽象ノード | アイコン | 役割 | MVP対応実装 | Phase 2以降 |
|-----------|---------|------|-------------|-------------|
| **LLMノード** | 💬 | 言語モデル処理 | OpenAI (GPT-4), Anthropic (Claude) | Ollama, Bedrock, Google AI |
| **RAGノード** | 📚 | ナレッジ検索 | Pinecone, Chroma | Supabase, Qdrant, Milvus |
| **メモリノード** | 🧠 | 会話履歴保持 | Buffer Memory | Zep Memory, Redis Memory |
| **出力ノード** | 📤 | 最終応答出力 | 標準出力 | - |
| **ツールノード** | 🔧 | 外部API呼び出し | Web検索 (Serper), Calculator | Loop(連携できるか不明), コード実行 |
| **入力ノード** | 📥 | ユーザー入力受取 | 標準入力 | - |
| **条件分岐ノード** | 🔀 | IF/ELSE分岐 | If-Else | - |

---

## 4. ユースケース × 機能マトリクス

### 4.1 開発部門向け

| ユースケース | 必要な機能 | 主要ノード |
|-------------|----------|-----------|
| **コード仕様理解** | RAG検索, LLM回答生成 | LLM, RAG, 出力 |
| **エラーログ解析** | RAG検索, パターンマッチング | LLM, RAG, 条件分岐 |
| **テストコード生成** | コード解析, LLM生成 | LLM, RAG, 出力 |
| **API仕様書更新** | コード読取, 差分検出 | LLM, ツール, 出力 |
| **PRセルフレビュー** | コード解析, セキュリティチェック | LLM, ツール |
| **WBS自動生成** | 要件解析, 過去事例参照 | LLM, RAG, 出力 |
| **進捗報告書生成** | データ取得, 集計, レポート生成 | ツール, LLM, 出力 |
| **リスク検知** | データ分析, パターン検出 | LLM, RAG, 条件分岐 |

### 4.2 バックオフィス部門向け

| ユースケース | 必要な機能 | 主要ノード |
|-------------|----------|-----------|
| **経費精算チェック** | 規程検索, 適合判定 | LLM, RAG, 条件分岐 |
| **月次決算レポート** | データ取得, 分析, 生成 | ツール, LLM, 出力 |
| **請求書仕訳** | OCR, 過去パターン参照 | LLM, RAG, 出力 |
| **規程問い合わせ対応** | RAG検索, 回答生成 | LLM, RAG, 条件分岐 |
| **研修資料作成** | 資料参照, コンテンツ生成 | LLM, RAG, 出力 |
| **契約書レビュー** | リスク検出, 修正提案 | LLM, RAG |
| **ヘルプデスク対応** | FAQ検索, 解決策提示 | LLM, RAG, 条件分岐 |

---

## 5. 機能別 優先度サマリー

### 5.1 MVP必須（Phase 1）

```
作成者向け: 27機能
├── 基本設定: 3機能（C-1〜C-3）
├── テンプレート: 2機能（C-5, C-6）
├── キャンバス基本: 6機能（C-8〜C-13）
├── 内部編集: 6機能（C-14〜C-19）
├── 人間チェック: 2機能（C-20, C-21）
├── テンプレート再利用: 5機能（C-24〜C-28）
├── RAG連携: 2機能（C-31, C-32）
├── テスト: 3機能（C-35〜C-37）
└── 公開: 2機能（C-41, C-42）

利用者向け: 10機能
├── カタログ: 4機能（C-46〜C-48, C-52）
├── チャット: 3機能（C-56〜C-58）
└── API: 3機能（C-64〜C-66）

管理者向け: 3機能
├── 権限管理: 1機能（M-1）
├── 監査: 1機能（M-8）
└── 接続監視: 1機能（M-9）
```

### 5.2 Phase 2以降

```
作成者向け: 14機能
├── 業務課題整理: 2機能
├── 詳細設定: 2機能
├── カスタムテンプレート: 2機能
├── RAG作成: 2機能
├── テストシナリオ: 3機能
└── 管理機能: 3機能

利用者向け: 7機能
├── 詳細フィルタ: 3機能
├── マイフクロウ: 3機能
└── フィードバック: 2機能

管理者向け: 7機能
├── 承認ワークフロー: 1機能
├── ダッシュボード: 2機能
├── ポートフォリオ管理: 1機能
└── バージョン管理: 2機能
```

---

## 6. 外部連携 × 機能マトリクス

| 連携先 | 連携方式 | 関連機能 | MVP |
|--------|---------|---------|-----|
| **Flowise** | REST API | Chatflow作成・実行 | ✅ |
| **Owlia-Portal** | REST API | フクロウ一覧取得、チャット実行 | ✅ |
| **Owlia-Sprite** | REST API | フクロウ一覧取得、チャット実行 | ✅ |
| **Owria-chronicle** (今後)| Custom Tool | 障害票・TODO起票、進捗取得、トレース | ✅ |
| **FastAPI** | Custom Tool | 社内システム連携 | ✅ |
