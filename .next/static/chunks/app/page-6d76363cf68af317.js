(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{52573:(e,t,a)=>{Promise.resolve().then(a.bind(a,93335))},93335:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>R});var o=a(95155),n=a(12115),s=a(75484),l=a(95368),r=a(68719),i=a(76962);a(11687);var d=a(34004),c=a(69367),u=a(48699),g=a(73583),p=a(39732),f=a(13538),h=a(36913),x=a(61040),v=a(80290),y=a(52834),A=a(58021),b=a(20389);let m=(0,b.A)((0,o.jsx)("path",{d:"M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8z"}),"Folder"),C=(0,b.A)((0,o.jsx)("path",{d:"m21.9 8.89-1.05-4.37c-.22-.9-1-1.52-1.91-1.52H5.05c-.9 0-1.69.63-1.9 1.52L2.1 8.89c-.24 1.02-.02 2.06.62 2.88.08.11.19.19.28.29V19c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-6.94c.09-.09.2-.18.28-.28.64-.82.87-1.87.62-2.89m-2.99-3.9 1.05 4.37c.1.42.01.84-.25 1.17-.14.18-.44.47-.94.47-.61 0-1.14-.49-1.21-1.14L16.98 5zM13 5h1.96l.54 4.52c.05.39-.07.78-.33 1.07-.22.26-.54.41-.95.41-.67 0-1.22-.59-1.22-1.31zM8.49 9.52 9.04 5H11v4.69c0 .72-.55 1.31-1.29 1.31-.34 0-.65-.15-.89-.41-.25-.29-.37-.68-.33-1.07m-4.45-.16L5.05 5h1.97l-.58 4.86c-.08.65-.6 1.14-1.21 1.14-.49 0-.8-.29-.93-.47-.27-.32-.36-.75-.26-1.17M5 19v-6.03c.08.01.15.03.23.03.87 0 1.66-.36 2.24-.95.6.6 1.4.95 2.31.95.87 0 1.65-.36 2.23-.93.59.57 1.39.93 2.29.93.84 0 1.64-.35 2.24-.95.58.59 1.37.95 2.24.95.08 0 .15-.02.23-.03V19z"}),"Storefront");var j=a(2921),w=a(63809),k=a(95071),S=a(50077),D=a(4189),I=a(39534),F=a(71500),N=a(71921),O=a(76046);let z={custom:w.A},E={buttonedge:k.A},T=[],H=[];function R(){let e=(0,O.useRouter)(),t=(0,n.useRef)(null),[a,b]=(0,n.useState)(null),[w,k,R]=(0,s.ck)(T),[L,P,_]=(0,s.fM)(H),[B,M]=(0,n.useState)(null),[V,G]=(0,n.useState)(!1),[J,W]=(0,n.useState)(!1),[K,X]=(0,n.useState)(!1),[Y,q]=(0,n.useState)([]),[Q,U]=(0,n.useState)({open:!1,message:"",severity:"info"});(0,n.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/owlagents");if(e.ok){let t=await e.json();q(t.map(e=>({id:e.id,name:e.name,description:e.description})))}}catch(e){console.error("Failed to load OwlAgents:",e)}})()},[]);let Z=(0,n.useRef)();Z.current=e=>{let t=w.find(t=>t.id===e);t&&(M(t),G(!0))};let $=(0,n.useRef)();$.current=e=>{k(t=>t.filter(t=>t.id!==e)),P(t=>t.filter(t=>t.source!==e&&t.target!==e)),(null==B?void 0:B.id)===e&&(M(null),G(!1))};let ee=(0,n.useCallback)(e=>{var t;null===(t=Z.current)||void 0===t||t.call(Z,e)},[]),et=(0,n.useCallback)(e=>{var t;null===(t=$.current)||void 0===t||t.call($,e)},[]),ea=(0,n.useCallback)(e=>{P(t=>(0,s.rN)({...e,type:"smoothstep",animated:!0},t))},[P]),eo=(0,n.useCallback)(e=>{e.preventDefault();let o=e.dataTransfer.getData("application/reactflow");if(!o||!a||!t.current)return;let n=JSON.parse(o),s=a.screenToFlowPosition({x:e.clientX,y:e.clientY}),l={id:"".concat(n.type,"-").concat(Date.now()),type:"custom",position:s,data:{label:n.label,type:n.type,category:n.category,config:{},agentId:n.agentId,agentName:n.agentId?n.label:void 0,onConfigure:ee,onDelete:et}};k(e=>[...e,l])},[a,k,ee,et]),en=(0,n.useCallback)(e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"},[]),es=(0,n.useCallback)((e,t)=>{M(t)},[]),el=(0,n.useCallback)((e,t)=>{M(t),G(!0)},[]),er=(0,n.useCallback)((e,t,a)=>{k(o=>o.map(o=>o.id===e?{...o,data:{...o.data,config:t,humanReview:a}}:o)),M(o=>(null==o?void 0:o.id)===e?{...o,data:{...o.data,config:t,humanReview:a}}:o)},[k]),ei=(0,n.useCallback)(()=>{G(!1)},[]),ed=(0,n.useCallback)(()=>{if(0===w.length){U({open:!0,message:"Please add at least one node before saving.",severity:"error"});return}W(!0)},[w]),ec=(0,n.useCallback)(async e=>{try{let t;e.syncToFlowise&&(t=(0,N.f2)(w,L));let a=await fetch("/api/owlagents",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e,flow:{nodes:w.map(e=>({id:e.id,type:e.data.type,position:e.position,data:{label:e.data.label,type:e.data.type,category:e.data.category,config:e.data.config,humanReview:e.data.humanReview,agentId:e.data.agentId,agentName:e.data.agentName}})),edges:L.map(e=>({id:e.id,source:e.source,target:e.target,sourceHandle:e.sourceHandle,targetHandle:e.targetHandle}))},flowiseFlowData:t})});if(!a.ok)throw Error("Failed to save agent");let o=await a.json(),n='Agent "'.concat(o.name,'" saved successfully!');o.flowiseChatflowId&&(n+=" (Flowise Chatflow: ".concat(o.flowiseChatflowId,")")),U({open:!0,message:n,severity:"success"}),W(!1),q(e=>[...e,{id:o.id,name:o.name,description:o.description}])}catch(e){U({open:!0,message:"Failed to save agent. Please try again.",severity:"error"})}},[w,L]),eu=(0,n.useCallback)(()=>{if(0===w.length){U({open:!0,message:"Please add at least one node before testing.",severity:"error"});return}X(!0)},[w]),eg=()=>{U(e=>({...e,open:!1}))};return(0,o.jsx)(s.Ln,{children:(0,o.jsxs)(d.A,{sx:{display:"flex",flexDirection:"column",height:"100vh",bgcolor:"#0f0f1a"},children:[(0,o.jsxs)(c.A,{sx:{borderRadius:0,bgcolor:"#16213e",borderBottom:"2px solid #0f3460",px:2,py:1,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,o.jsxs)(d.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,o.jsxs)(u.A,{variant:"h6",sx:{fontWeight:700,color:"#e94560",display:"flex",alignItems:"center",gap:1},children:[(0,o.jsx)("span",{style:{fontSize:"1.3rem"},children:"\uD83E\uDD89"}),"OwliaFabrica"]}),(0,o.jsx)(u.A,{sx:{fontSize:"0.9rem",color:"#888",borderLeft:"1px solid #444",pl:2},children:"Agent Builder"})]}),(0,o.jsxs)(d.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,o.jsx)(g.A,{variant:"outlined",startIcon:(0,o.jsx)(y.A,{}),onClick:eu,sx:{color:"#4CAF50",borderColor:"#4CAF50","&:hover":{borderColor:"#66BB6A",bgcolor:"rgba(76, 175, 80, 0.1)"}},children:"Test Run"}),(0,o.jsx)(g.A,{variant:"contained",startIcon:(0,o.jsx)(v.A,{}),onClick:ed,sx:{bgcolor:"#6366f1","&:hover":{bgcolor:"#5558e3"}},children:"Save Agent"}),(0,o.jsx)(p.A,{title:"Saved Agents",children:(0,o.jsx)(f.A,{onClick:()=>e.push("/agent-canvas"),sx:{color:"#90CAF9"},children:(0,o.jsx)(m,{})})}),(0,o.jsx)(p.A,{title:"Agent Store",children:(0,o.jsx)(f.A,{onClick:()=>e.push("/store"),sx:{color:"#e94560"},children:(0,o.jsx)(C,{})})}),(0,o.jsx)(p.A,{title:"Go to Chat",children:(0,o.jsx)(f.A,{onClick:()=>e.push("/chat"),sx:{color:"#90CAF9"},children:(0,o.jsx)(A.A,{})})})]})]}),(0,o.jsxs)(d.A,{sx:{display:"flex",flex:1,overflow:"hidden"},children:[(0,o.jsx)(j.A,{savedOwlAgents:Y}),(0,o.jsxs)(d.A,{ref:t,sx:{flex:1,position:"relative"},children:[(0,o.jsxs)(s.Gc,{nodes:w,edges:L,onNodesChange:R,onEdgesChange:_,onConnect:ea,onInit:b,onDrop:eo,onDragOver:en,onNodeClick:es,onNodeDoubleClick:el,nodeTypes:z,edgeTypes:E,fitView:!0,snapToGrid:!0,snapGrid:[15,15],defaultEdgeOptions:{type:"smoothstep",animated:!0,style:{stroke:"#6366f1",strokeWidth:2}},style:{background:"#0f0f1a"},children:[(0,o.jsx)(l.H,{}),(0,o.jsx)(r.o,{style:{backgroundColor:"#1e1e2f",border:"1px solid #2d2d44"},nodeColor:e=>{var t;let a=(0,F.KF)(null===(t=e.data)||void 0===t?void 0:t.type);return(null==a?void 0:a.color)||"#607D8B"}}),(0,o.jsx)(i.V,{color:"#2d2d44",gap:20,size:1})]}),0===w.length&&(0,o.jsxs)(d.A,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",textAlign:"center",pointerEvents:"none"},children:[(0,o.jsx)(u.A,{sx:{color:"#666",fontSize:"1.2rem",mb:1},children:"Drag nodes from the palette to get started"}),(0,o.jsx)(u.A,{sx:{color:"#444",fontSize:"0.9rem"},children:"Connect nodes to build your AI agent workflow"})]})]}),V&&B&&(0,o.jsx)(S.A,{nodeId:B.id,nodeData:B.data,onClose:ei,onSave:er,savedOwlAgents:Y})]}),(0,o.jsx)(D.A,{open:J,onClose:()=>W(!1),onSave:ec}),(0,o.jsx)(I.A,{open:K,onClose:()=>X(!1),nodes:w,edges:L}),(0,o.jsx)(h.A,{open:Q.open,autoHideDuration:4e3,onClose:eg,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:(0,o.jsx)(x.A,{onClose:eg,severity:Q.severity,sx:{width:"100%"},children:Q.message})})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[294,702,708,96,783,539,971,769,734,192,916,189,441,517,358],()=>t(52573)),_N_E=e.O()}]);