(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[457],{13533:(e,r,o)=>{Promise.resolve().then(o.bind(o,50669))},50669:(e,r,o)=>{"use strict";o.r(r),o.d(r,{default:()=>w});var s=o(95155),l=o(12115),t=o(58803),n=o.n(t),i=o(76046),a=o(67396),c=o(34004),d=o(30495),f=o(69367),x=o(48699),u=o(61040),h=o(13538),p=o(49067),b=o(32625),g=o(96347),m=o(5912),j=o(5090);async function y(e,r){let o=e.nodes.map(e=>{var r;return(null===(r=e.data)||void 0===r?void 0:r.label)||"unknown"});return await new Promise(e=>setTimeout(e,1e3)),"**".concat(e.name,"** からの応答:\n\n")+"あなたのメッセージ「".concat(r,"」を受け取りました。\n\n")+"このフローには以下のノードが含まれています:\n"+o.map(e=>"- ".concat(e)).join("\n")+"\n\n_※ これはモック応答です。実際のLLM連携を設定すると、AIが応答を生成します。_"}function A(){var e;let r=(0,i.useSearchParams)().get("flowId"),[o,t]=(0,l.useState)(null),[A,v]=(0,l.useState)(!0),[w,C]=(0,l.useState)(null),[D,k]=(0,l.useState)([]),[S,_]=(0,l.useState)(""),[I,R]=(0,l.useState)(!1),F=(0,l.useRef)(null);(0,l.useEffect)(()=>{if(r){let e=function(e){try{let r=localStorage.getItem("owliafabrica_flows");if(!r)return null;return JSON.parse(r).find(r=>r.id===e)||null}catch(e){return null}}(r);e?(t(e),k([{id:"welcome",role:"assistant",content:"こんにちは！**".concat(e.name,"** にようこそ。\n\n何かお手伝いできることはありますか？"),timestamp:new Date}])):C("フローが見つかりません")}v(!1)},[r]),(0,l.useEffect)(()=>{var e;null===(e=F.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[D]);let N=async()=>{if(!S.trim()||!o||I)return;let e={id:"user_".concat(Date.now()),role:"user",content:S.trim(),timestamp:new Date};k(r=>[...r,e]),_(""),R(!0);try{let r=await y(o,e.content),s={id:"assistant_".concat(Date.now()),role:"assistant",content:r,timestamp:new Date};k(e=>[...e,s])}catch(e){C("応答の生成に失敗しました")}finally{R(!1)}};return A?(0,s.jsx)(c.A,{sx:{height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"#1a1a2e"},children:(0,s.jsx)(d.A,{sx:{color:"#e94560"}})}):r?w?(0,s.jsxs)(c.A,{sx:{height:"100vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",bgcolor:"#1a1a2e",p:4},children:[(0,s.jsx)(u.A,{severity:"error",sx:{mb:2},children:w}),(0,s.jsx)(a.default,{href:"/",style:{display:"inline-block",padding:"12px 24px",backgroundColor:"#e94560",color:"#fff",borderRadius:"8px",textDecoration:"none",fontWeight:600},children:"ホームに戻る"})]}):(0,s.jsxs)(c.A,{sx:{height:"100vh",display:"flex",flexDirection:"column",bgcolor:"#1a1a2e"},children:[(0,s.jsxs)(f.A,{sx:{px:2,py:1.5,display:"flex",alignItems:"center",gap:2,bgcolor:"#16213e",borderBottom:"2px solid #0f3460",borderRadius:0},children:[(0,s.jsx)(a.default,{href:"/",children:(0,s.jsx)(h.A,{sx:{color:"rgba(255,255,255,0.7)"},children:(0,s.jsx)(g.A,{})})}),(0,s.jsx)(c.A,{sx:{width:40,height:40,borderRadius:"50%",bgcolor:"#e94560",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,s.jsx)("span",{style:{fontSize:"1.2rem"},className:"jsx-dce2f2b49430677",children:"\uD83E\uDD89"})}),(0,s.jsxs)(c.A,{sx:{flex:1},children:[(0,s.jsx)(x.A,{variant:"subtitle1",sx:{color:"#fff",fontWeight:600},children:(null==o?void 0:o.name)||"Chat"}),(0,s.jsxs)(x.A,{variant:"caption",sx:{color:"rgba(255,255,255,0.5)"},children:[(null==o?void 0:null===(e=o.nodes)||void 0===e?void 0:e.length)||0," ノード"]})]})]}),(0,s.jsxs)(c.A,{sx:{flex:1,overflow:"auto",p:2},children:[D.map(e=>(0,s.jsxs)(c.A,{sx:{display:"flex",gap:1.5,mb:2,flexDirection:"user"===e.role?"row-reverse":"row"},children:[(0,s.jsx)(c.A,{sx:{width:36,height:36,borderRadius:"50%",bgcolor:"user"===e.role?"#2196F3":"#e94560",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:"user"===e.role?(0,s.jsx)(j.A,{sx:{color:"#fff",fontSize:20}}):(0,s.jsx)(m.A,{sx:{color:"#fff",fontSize:20}})}),(0,s.jsx)(f.A,{sx:{p:2,maxWidth:"70%",bgcolor:"user"===e.role?"#0f3460":"#16213e",border:"1px solid #0f3460"},children:(0,s.jsx)(x.A,{sx:{color:"#fff",whiteSpace:"pre-wrap","& strong":{color:"#90CAF9"},"& em":{color:"rgba(255,255,255,0.6)"}},dangerouslySetInnerHTML:{__html:e.content.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/_(.*?)_/g,"<em>$1</em>").replace(/\n/g,"<br/>")}})})]},e.id)),I&&(0,s.jsxs)(c.A,{sx:{display:"flex",gap:1.5,mb:2},children:[(0,s.jsx)(c.A,{sx:{width:36,height:36,borderRadius:"50%",bgcolor:"#e94560",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,s.jsx)(m.A,{sx:{color:"#fff",fontSize:20}})}),(0,s.jsx)(f.A,{sx:{p:2,bgcolor:"#16213e",border:"1px solid #0f3460"},children:(0,s.jsxs)(c.A,{sx:{display:"flex",gap:.5},children:[(0,s.jsx)(c.A,{sx:{width:8,height:8,borderRadius:"50%",bgcolor:"#90CAF9",animation:"pulse 1s infinite",animationDelay:"0s"}}),(0,s.jsx)(c.A,{sx:{width:8,height:8,borderRadius:"50%",bgcolor:"#90CAF9",animation:"pulse 1s infinite",animationDelay:"0.2s"}}),(0,s.jsx)(c.A,{sx:{width:8,height:8,borderRadius:"50%",bgcolor:"#90CAF9",animation:"pulse 1s infinite",animationDelay:"0.4s"}})]})})]}),(0,s.jsx)("div",{ref:F,className:"jsx-dce2f2b49430677"})]}),(0,s.jsx)(f.A,{sx:{p:2,bgcolor:"#16213e",borderTop:"2px solid #0f3460",borderRadius:0},children:(0,s.jsxs)(c.A,{sx:{display:"flex",gap:1},children:[(0,s.jsx)(p.A,{fullWidth:!0,value:S,onChange:e=>_(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),N())},placeholder:"メッセージを入力...",variant:"outlined",size:"small",disabled:I,sx:{"& .MuiOutlinedInput-root":{bgcolor:"#0f3460",color:"#fff","& fieldset":{borderColor:"#0f3460"},"&:hover fieldset":{borderColor:"#90CAF9"},"&.Mui-focused fieldset":{borderColor:"#e94560"}},"& .MuiInputBase-input::placeholder":{color:"rgba(255,255,255,0.5)"}}}),(0,s.jsx)(h.A,{onClick:N,disabled:!S.trim()||I,sx:{bgcolor:"#e94560",color:"#fff","&:hover":{bgcolor:"#c73e54"},"&.Mui-disabled":{bgcolor:"#0f3460",color:"rgba(255,255,255,0.3)"}},children:(0,s.jsx)(b.A,{})})]})}),(0,s.jsx)(n(),{id:"dce2f2b49430677",children:"@-webkit-keyframes pulse{0%,100%{opacity:.4}50%{opacity:1}}@-moz-keyframes pulse{0%,100%{opacity:.4}50%{opacity:1}}@-o-keyframes pulse{0%,100%{opacity:.4}50%{opacity:1}}@keyframes pulse{0%,100%{opacity:.4}50%{opacity:1}}"})]}):(0,s.jsx)(c.A,{sx:{height:"100vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",bgcolor:"#1a1a2e",p:4},children:(0,s.jsxs)(f.A,{sx:{p:4,maxWidth:400,textAlign:"center",bgcolor:"#16213e",border:"1px solid #0f3460"},children:[(0,s.jsx)(m.A,{sx:{fontSize:64,color:"rgba(255,255,255,0.3)",mb:2}}),(0,s.jsx)(x.A,{variant:"h5",sx:{color:"#fff",mb:2},children:"フローを選択してください"}),(0,s.jsx)(x.A,{sx:{color:"rgba(255,255,255,0.6)",mb:3},children:"チャットを開始するには、Flow Builder でフローを作成し、チャットアイコンをクリックしてください。"}),(0,s.jsx)(a.default,{href:"/",style:{display:"inline-block",padding:"12px 24px",backgroundColor:"#e94560",color:"#fff",borderRadius:"8px",textDecoration:"none",fontWeight:600},children:"Flow Builder へ"})]})})}function v(){return(0,s.jsx)("div",{className:"h-screen flex items-center justify-center bg-gray-50",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-500"})})}function w(){return(0,s.jsx)(l.Suspense,{fallback:(0,s.jsx)(v,{}),children:(0,s.jsx)(A,{})})}}},e=>{var r=r=>e(e.s=r);e.O(0,[708,27,441,517,358],()=>r(13533)),_N_E=e.O()}]);