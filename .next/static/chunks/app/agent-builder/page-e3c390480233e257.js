(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[234],{25228:(e,t,a)=>{Promise.resolve().then(a.bind(a,82002))},82002:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>H});var o=a(95155),n=a(12115),s=a(75484),l=a(95368),r=a(68719),i=a(76962);a(11687);var d=a(34004),c=a(69367),u=a(39732),g=a(13538),f=a(48699),p=a(73583),h=a(36913),x=a(61040),v=a(80290),y=a(52834),b=a(58021);let m=(0,a(20389).A)((0,o.jsx)("path",{d:"M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"}),"Home");var C=a(76046),A=a(2921),j=a(63809),k=a(95071),w=a(50077),S=a(4189),D=a(39534),I=a(71500),N=a(71921);let O={custom:j.A},E={buttonedge:k.A},F=[],T=[];function H(){let e=(0,C.useRouter)(),t=(0,n.useRef)(null),[a,j]=(0,n.useState)(null),[k,H,R]=(0,s.ck)(F),[z,B,P]=(0,s.fM)(T),[_,G]=(0,n.useState)(null),[J,L]=(0,n.useState)(!1),[M,V]=(0,n.useState)(!1),[W,K]=(0,n.useState)(!1),[X,Y]=(0,n.useState)([]),[q,Q]=(0,n.useState)({open:!1,message:"",severity:"info"});(0,n.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/owlagents");if(e.ok){let t=await e.json();Y(t.map(e=>({id:e.id,name:e.name,description:e.description})))}}catch(e){console.error("Failed to load OwlAgents:",e)}})()},[]);let U=(0,n.useRef)();U.current=e=>{let t=k.find(t=>t.id===e);t&&(G(t),L(!0))};let Z=(0,n.useRef)();Z.current=e=>{H(t=>t.filter(t=>t.id!==e)),B(t=>t.filter(t=>t.source!==e&&t.target!==e)),(null==_?void 0:_.id)===e&&(G(null),L(!1))};let $=(0,n.useCallback)(e=>{var t;null===(t=U.current)||void 0===t||t.call(U,e)},[]),ee=(0,n.useCallback)(e=>{var t;null===(t=Z.current)||void 0===t||t.call(Z,e)},[]),et=(0,n.useCallback)(e=>{B(t=>(0,s.rN)({...e,type:"smoothstep",animated:!0},t))},[B]),ea=(0,n.useCallback)(e=>{e.preventDefault();let o=e.dataTransfer.getData("application/reactflow");if(!o||!a||!t.current)return;let n=JSON.parse(o),s=a.screenToFlowPosition({x:e.clientX,y:e.clientY}),l={id:"".concat(n.type,"-").concat(Date.now()),type:"custom",position:s,data:{label:n.label,type:n.type,category:n.category,config:{},agentId:n.agentId,agentName:n.agentId?n.label:void 0,onConfigure:$,onDelete:ee}};H(e=>[...e,l])},[a,H,$,ee]),eo=(0,n.useCallback)(e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"},[]),en=(0,n.useCallback)((e,t)=>{G(t)},[]),es=(0,n.useCallback)((e,t)=>{G(t),L(!0)},[]),el=(0,n.useCallback)((e,t,a)=>{H(o=>o.map(o=>o.id===e?{...o,data:{...o.data,config:t,humanReview:a}}:o)),G(o=>(null==o?void 0:o.id)===e?{...o,data:{...o.data,config:t,humanReview:a}}:o)},[H]),er=(0,n.useCallback)(()=>{L(!1)},[]),ei=(0,n.useCallback)(()=>{if(0===k.length){Q({open:!0,message:"Please add at least one node before saving.",severity:"error"});return}V(!0)},[k]),ed=(0,n.useCallback)(async e=>{try{let t;e.syncToFlowise&&(t=(0,N.f2)(k,z));let a=await fetch("/api/owlagents",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e,flow:{nodes:k.map(e=>({id:e.id,type:e.data.type,position:e.position,data:{label:e.data.label,type:e.data.type,category:e.data.category,config:e.data.config,humanReview:e.data.humanReview,agentId:e.data.agentId,agentName:e.data.agentName}})),edges:z.map(e=>({id:e.id,source:e.source,target:e.target,sourceHandle:e.sourceHandle,targetHandle:e.targetHandle}))},flowiseFlowData:t})});if(!a.ok)throw Error("Failed to save agent");let o=await a.json(),n='Agent "'.concat(o.name,'" saved successfully!');o.flowiseChatflowId&&(n+=" (Flowise Chatflow: ".concat(o.flowiseChatflowId,")")),Q({open:!0,message:n,severity:"success"}),V(!1),Y(e=>[...e,{id:o.id,name:o.name,description:o.description}])}catch(e){Q({open:!0,message:"Failed to save agent. Please try again.",severity:"error"})}},[k,z]),ec=(0,n.useCallback)(()=>{if(0===k.length){Q({open:!0,message:"Please add at least one node before testing.",severity:"error"});return}K(!0)},[k]),eu=()=>{Q(e=>({...e,open:!1}))};return(0,o.jsx)(s.Ln,{children:(0,o.jsxs)(d.A,{sx:{display:"flex",flexDirection:"column",height:"100vh",bgcolor:"#0f0f1a"},children:[(0,o.jsxs)(c.A,{sx:{borderRadius:0,bgcolor:"#16213e",borderBottom:"2px solid #0f3460",px:2,py:1,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,o.jsxs)(d.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,o.jsx)(u.A,{title:"Back to Home",children:(0,o.jsx)(g.A,{onClick:()=>e.push("/"),sx:{color:"#888"},children:(0,o.jsx)(m,{})})}),(0,o.jsxs)(f.A,{variant:"h6",sx:{fontWeight:700,color:"#fff",display:"flex",alignItems:"center",gap:1},children:[(0,o.jsx)("span",{style:{fontSize:"1.3rem"},children:"\uD83E\uDD89"}),"Agent Builder"]})]}),(0,o.jsxs)(d.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,o.jsx)(p.A,{variant:"outlined",startIcon:(0,o.jsx)(y.A,{}),onClick:ec,sx:{color:"#4CAF50",borderColor:"#4CAF50","&:hover":{borderColor:"#66BB6A",bgcolor:"rgba(76, 175, 80, 0.1)"}},children:"Test Run"}),(0,o.jsx)(p.A,{variant:"contained",startIcon:(0,o.jsx)(v.A,{}),onClick:ei,sx:{bgcolor:"#6366f1","&:hover":{bgcolor:"#5558e3"}},children:"Save Agent"}),(0,o.jsx)(u.A,{title:"Go to Chat",children:(0,o.jsx)(g.A,{onClick:()=>e.push("/chat"),sx:{color:"#90CAF9"},children:(0,o.jsx)(b.A,{})})})]})]}),(0,o.jsxs)(d.A,{sx:{display:"flex",flex:1,overflow:"hidden"},children:[(0,o.jsx)(A.A,{savedOwlAgents:X}),(0,o.jsxs)(d.A,{ref:t,sx:{flex:1,position:"relative"},children:[(0,o.jsxs)(s.Gc,{nodes:k,edges:z,onNodesChange:R,onEdgesChange:P,onConnect:et,onInit:j,onDrop:ea,onDragOver:eo,onNodeClick:en,onNodeDoubleClick:es,nodeTypes:O,edgeTypes:E,fitView:!0,snapToGrid:!0,snapGrid:[15,15],defaultEdgeOptions:{type:"smoothstep",animated:!0,style:{stroke:"#6366f1",strokeWidth:2}},style:{background:"#0f0f1a"},children:[(0,o.jsx)(l.H,{}),(0,o.jsx)(r.o,{style:{backgroundColor:"#1e1e2f",border:"1px solid #2d2d44"},nodeColor:e=>{var t;let a=(0,I.KF)(null===(t=e.data)||void 0===t?void 0:t.type);return(null==a?void 0:a.color)||"#607D8B"}}),(0,o.jsx)(i.V,{color:"#2d2d44",gap:20,size:1})]}),0===k.length&&(0,o.jsxs)(d.A,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",textAlign:"center",pointerEvents:"none"},children:[(0,o.jsx)(f.A,{sx:{color:"#666",fontSize:"1.2rem",mb:1},children:"Drag nodes from the palette to get started"}),(0,o.jsx)(f.A,{sx:{color:"#444",fontSize:"0.9rem"},children:"Connect nodes to build your AI agent workflow"})]})]}),J&&_&&(0,o.jsx)(w.A,{nodeId:_.id,nodeData:_.data,onClose:er,onSave:el,savedOwlAgents:X},"config-".concat(_.id,"-").concat(JSON.stringify(_.data.config||{})))]}),(0,o.jsx)(S.A,{open:M,onClose:()=>V(!1),onSave:ed}),(0,o.jsx)(D.A,{open:W,onClose:()=>K(!1),nodes:k,edges:z}),(0,o.jsx)(h.A,{open:q.open,autoHideDuration:4e3,onClose:eu,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:(0,o.jsx)(x.A,{onClose:eu,severity:q.severity,sx:{width:"100%"},children:q.message})})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[294,702,708,96,783,539,971,769,734,192,916,189,441,517,358],()=>t(25228)),_N_E=e.O()}]);